"use strict";function Colme(a){function l(a){var b=[{node:k,index:0}];do{var c=b[b.length-1];0===c.node.children.length&&c.node.parent?(h.find("."+c.node.parent.id).each(function(){$(this).parent().append($(this)),$(this).removeClass("cm-hidden")}).width(a[c.node.id].width).addClass(a[c.node.id].visible?"":"cm-hidden"),b.pop()):c.index>=c.node.children.length?b.pop():(0===c.index&&c.node.parent&&(c.node.DOMelement.parent().append(c.node.DOMelement),c.node.DOMelement.width(a[c.node.id].width),c.node.DOMelement.removeClass("cm-hidden"),c.node.DOMelement.addClass(a[c.node.id].visible?"":"cm-hidden")),b.push({node:c.node.children[c.index++],index:0}))}while(b.length>1);h.trigger("colme:reflow")}function m(){return"Hey! Thank You for using this plugin! We really had a blast making it! Kisses if you are a hot girl!"}function n(a,b,c){var d=a.find("."+b).last();d.length>0&&d.after(c)}function o(a){var b=$(window).scrollLeft(),d=Math.max(Math.min(a.pageX,c.upperBoundX-b),c.lowerBoundX-b);c.DOMelement.css("transform","translate3D("+d+"px, 0, 0)")}function p(){var a=c.DOMelement.find(e.head),d=c.DOMelement.find(e.body),f=$(".cm-drag-placeholder"),k=f.first().parents(e.row);c.DOMelement.css("left",-1e3),$(window).unbind("mousemove"),$(window).unbind("mouseup"),a.find(e.row).each(function(a){var b=$(this).find(e.th);i.find(e.row).eq(a).find(".cm-drag-placeholder").before(b)}),d.find(e.row).each(function(a){var b=$(this).find(e.td);j.find(e.row).eq(a).find(".cm-drag-placeholder").before(b)});var l=[];k.find("."+b[c.groupId].parent.id).each(function(){l.push($(this).attr(g.id))}),b[c.groupId].parent.children.sort(function(a,b){return l.indexOf(a.id)-l.indexOf(b.id)}),$(".cm-drag-placeholder").remove(),c.DOMelement.find(e.row).remove(),h.trigger("colme:reflow")}function q(a){var b=h.find(".cm-drag-placeholder").first(),d=b.offset().left,e=b.prev(),f=b.next(),i=$(window).scrollLeft(),j=Math.max(Math.min(a.pageX+i,c.upperBoundX),c.lowerBoundX)-c.mouseOffsetX;j>=d+.4*f.width()?r(b,!0,f.attr(g.id)):j<=d-.6*e.width()&&r(b,!1,e.attr(g.id))}function r(a,b,d){c.DOMelement.find(e.row).each(function(a){var c=h.find(e.row).eq(a),f=c.find("."+d+",["+g.id+"="+d+"]").length;b?c.find(".cm-drag-placeholder").each(function(){$(this).siblings().addBack().eq($(this).index()+f).after($(this))}):c.find(".cm-drag-placeholder").each(function(){$(this).siblings().addBack().eq($(this).index()-f).before($(this))})})}function s(){var a=0;i.find(e.row).first().find(e.th).each(function(){var b=parseInt($(this).attr(g.span));a+=b?b:1}),k=new v(void 0,a,0);for(var c=i.find(e.row),d=[k],f=0;f<c.length;f++){for(var h=[],l=0,m=$(c[f]).find(e.th),n=0;n<m.length;n++){var o=$(m[n]).attr(g.span);o=parseInt(o?o:"1");for(var p=0,q=0;q<d.length;q++)if(l<d[q].colspanOffset+d[q].colspan){var r="cm-"+f+"-"+n+"-"+q;$(m[n]).addClass(d[q].classes),$(m[n]).addClass(d[q].id),$(m[n]).attr(g.id,r),p=new v(d[q],o,l,r),b[p.id]=p,d[q].addChild(p);break}h.push(p),l+=o}d=h}var s=0,t=0,u=j.find(e.row),w=j.find(e.td);i.find(e.row).last().find(e.th).each(function(){var a=b[$(this).attr(g.id)];for(s+=a.colspan;s>t;)u.each(function(){$(this).children().eq(t).addClass(a.classes+" "+a.id)}),t+=$(w[t]).attr(g.span)?$(w[t]).attr(g.span):1});var x=[];for(var y in b)0===b[y].children.length&&x.push(b[y]);for(var z=j.find(e.row).first(),A=0;A<x.length;A++)z.find("."+x[A].id).each(function(a){var c=new v(x[A],1,0,x[A].id+"--"+A+"--"+a);c.DOMelement=$(this),x[A].addChild(c),b[c.id]=c,c.DOMelement.attr(g.id,c.id)})}function t(){var a=i.find(e.row);a.each(function(){$(this).children("div").each(function(){$(this).addClass(d.th)})}),a=j.find(e.row),a.each(function(){$(this).children("div").each(function(){$(this).addClass(d.td)})})}function v(a,b,c,d){this.parent=a,this.children=[],this.colspan=b,this.colspanOffset=c,this.id=d?d:"cm-root",this.classes="",this.DOMelement=i.find("["+g.id+"="+d+"]"),this.resizeAcumulator=0,this.resizeAmount=0,this.minimumWidth=0,this.parent&&(this.classes=this.parent.classes+" "+this.parent.id),this.addChild=function(a){this.children.push(a)},this.getWidth=function(){return this.DOMelement.width()+parseInt(this.DOMelement.css("border-left-width"))+parseInt(this.DOMelement.css("border-right-width"))+parseInt(this.DOMelement.css("padding-left"))+parseInt(this.DOMelement.css("padding-right"))+parseInt(this.DOMelement.css("margin-right"))+parseInt(this.DOMelement.css("margin-left"))},this.getWidthResize=function(a){return a-(parseInt(this.DOMelement.css("border-left-width"))+parseInt(this.DOMelement.css("border-right-width"))+parseInt(this.DOMelement.css("padding-left"))+parseInt(this.DOMelement.css("padding-right"))+parseInt(this.DOMelement.css("margin-right"))+parseInt(this.DOMelement.css("margin-left")))},this.getImmutableWidth=function(){return parseInt(this.DOMelement.css("border-left-width"))+parseInt(this.DOMelement.css("border-right-width"))+parseInt(this.DOMelement.css("padding-left"))+parseInt(this.DOMelement.css("padding-right"))+parseInt(this.DOMelement.css("margin-right"))+parseInt(this.DOMelement.css("margin-left"))},this.getMutableWidth=function(){return parseInt(this.DOMelement.width())},this.isVisible=function(){return this.DOMelement?this.DOMelement.hasClass("cm-hidden")?!1:!0:!0},this.toJSON=function(){return{colspan:this.colspan,id:this.id,children:this.children}},this.toObject=function(){var a={colspan:this.colspan,id:this.id,width:this.DOMelement.width(),children:[],visible:!this.DOMelement.hasClass("cm-hidden")};for(var b in this.children)a.children.push(this.children[b].toObject());return a},this.setCellWidth=function(){if(!this.children||this.children.length<1)return this.DOMelement.is(":visible")?this.getWidth():0;for(var a=0,b=0;b<this.children.length;b++)a+=this.children[b].setCellWidth();return 0===a?this.DOMelement.addClass("cm-hidden"):(this.DOMelement.width(this.getWidthResize(a)),this.DOMelement.removeClass("cm-hidden")),a}}var b={},c={};a.selectors||(a.selectors={}),a.attributes||(a.attributes={}),a.modules||(a.modules={});var k,d={head:a.selectors.head?a.selectors.head:"cm-thead",body:a.selectors.body?a.selectors.body:"cm-tbody",row:a.selectors.row?a.selectors.row:"cm-tr",th:a.selectors.th?a.selectors.th:"cm-th",td:a.selectors.td?a.selectors.td:"cm-td"},e={head:"."+d.head,body:"."+d.body,row:"."+d.row,th:"."+d.th,td:"."+d.td},f={resize:a.modules.resize===!1?!1:!0,draggable:a.modules.draggable===!1?!1:!0,stickyH:a.modules.stickyHead===!1?!1:!0,toggleC:a.modules.toggleable===!1?!1:!0,addMarkup:a.modules.markup===!1?!1:!0},g={id:a.attributes.id?a.attributes.id:"data-cm-id",span:a.attributes.span?a.attributes.span:"data-cm-span",floater:"cm-floater"},h=a.table,i=h.find(e.head),j=h.find(e.body);if(this.toggleable=function(){var a=function(a,c){var d=h.find("."+c),f=h.find("["+g.id+"="+c+"]");if(f.is(":visible")){var i=b[c];d.addClass("cm-hidden"),d.filter(e.th).each(function(){h.trigger("colme:hidden",$(this).attr(g.id))}),f.addClass("cm-hidden"),h.trigger("colme:hidden",c);for(var j=i.parent;j;j=j.parent)j.setCellWidth();h.trigger("colme:reflow")}},c=function(a,c){var d=h.find("["+g.id+"="+c+"]"),f=h.find("."+c);if(!d.is(":visible")){f.removeClass("cm-hidden"),f.filter(e.th).each(function(){h.trigger("colme:shown",$(this).attr(g.id))});var i=b[c],j=i.getWidth(),k=i.parent;for(d.removeClass("cm-hidden"),h.trigger("colme:shown",c);k;k=k.parent)k.parent&&(k.DOMelement.removeClass("cm-hidden"),h.trigger("colme:shown",k.id),k.DOMelement.width(k.DOMelement.width()+j),k.setCellWidth());h.trigger("colme:reflow")}};h.on("colme:hideColumn",a),h.on("colme:showColumn",c),h.on("colme:toggleColumn",function(b,d){var e=h.find("["+g.id+"="+d+"]").first();return e.is(":visible")?(a(b,d),void 0):(c(b,d),void 0)})},this.getLayout=function(){var a={};for(var c in b)a[c]=b[c].toObject();return a},this.setLayout=function(a){"string"==typeof a&&(a=JSON.parse(a));var c;for(var d in a){c=b[a[d].id];var e={};for(var f in c.children)e[c.children[f].id]=c.children[f];var g=[];for(var h in a[d].children)g.push(e[a[d].children[h].id]);c.children=g}l(a)},this.resizable=function(){var a=i.find(e.th+"["+g.id+"]");$("<style>.ui-resizable-helper::after{height: "+h.height()+"px;}</style>").appendTo("head"),$(a).each(function(){$(this).resizable({handles:"e",distance:3,helper:"ui-resizable-helper",start:function(a,b){$(b.helper).height(b.originalSize.height),$(b.helper).css("top",h.offset().top)},stop:function(a,c){var d=c.originalSize.width,e=c.size.width,f=e-d,i=Math.abs(f),k=f>0?1:-1,l=$(c.element.context),m=b[l.attr(g.id)];m.DOMelement.width(m.getWidthResize(d)),m.resizeAcumulator=0,m.resizeAmount=i;var n=[{iterated:!1,node:m}],o=[{iterated:!1,node:m}],p=[];do{var q=n[n.length-1];if(q.iterated){if(n.pop(),!q.node.isVisible())continue;q.node.parent.resizeAcumulator+=q.node.resizeAcumulator}else{for(var r=0;r<q.node.children.length;r++){var s={iterated:!1,node:q.node.children[r]};s.node.resizeAmount=Math.floor(q.node.resizeAmount*s.node.getWidth()/q.node.getWidth()),s.node.minimumWidth=Math.ceil(q.node.getImmutableWidth()*s.node.DOMelement.width()/q.node.DOMelement.width()),s.node.resizeAcumulator=0,n.push(s),o.push(s)}if(0===q.node.children.length&&q.node.isVisible()){if(q.node.resizeAcumulator=q.node.resizeAmount,0>k){var t=!1,u=!1;q.node.minimumWidth>q.node.getWidth()-q.node.resizeAmount&&(t=q.node.getWidth()-q.node.minimumWidth),q.node.resizeAmount>q.node.getMutableWidth()&&(u=q.node.getMutableWidth()-1),(t||u)&&(t=t===!1?Number.MAX_VALUE:t,u=u===!1?Number.MAX_VALUE:u,q.node.resizeAcumulator=u>t?t:u)}p.push(q)}q.iterated=!0}}while(n.length>1);for(var v=0;v<o.length;v++)o[v].node.DOMelement.width(o[v].node.resizeAcumulator*k+o[v].node.getMutableWidth());for(v=0;v<p.length;v++){var w=p[v].node.parent.DOMelement.attr(g.id);j.find("."+w).width(p[v].node.getMutableWidth())}for(var x=m.parent;x;x=x.parent)x.DOMelement.width(x.getMutableWidth()+m.resizeAcumulator*k);h.trigger("colme:reflow")}}),$(this).on("resizestart",function(a){a.stopPropagation()})})},this.draggable=function(){i.find(e.th).mousedown(function(a){if(a.target==this&&1==a.which){var d=$(this).width(),f=$(this).attr(g.id);c.startPosX=$(this).offset().left-$(window).scrollLeft(),c.startPosY=$(this).offset().top+$(window).scrollTop(),c.mouseOffsetX=a.pageX-c.startPosX,c.groupId=f;var h=b[f].parent.DOMelement;(!h||h.length<1)&&(h=i),c.lowerBoundX=h.offset().left+c.mouseOffsetX,c.upperBoundX=h.offset().left+h.width()+c.mouseOffsetX-d;var k=e.th.replace(".",""),l=e.td.replace(".",""),m=$("<div>",{"class":"cm-drag-placeholder "+k,width:d}),r=$("<div>",{"class":"cm-drag-placeholder "+l,width:d});$(this).after(m.clone()),i.find(e.row).each(function(){n($(this),f,m.clone())}),j.find(e.row).each(function(){n($(this),f,r.clone())});var s=c.DOMelement.find(e.head),t=c.DOMelement.find(e.body);i.find(e.row).each(function(){var a=$(this).find("."+f+" ,["+g.id+"="+f+"]"),b=$("<div>",{"class":e.row.replace(".","")});b.append(a),s.append(b)}),j.find(e.row).each(function(){var a=$(this).find("."+f),b=$("<div>",{"class":e.row.replace(".","")});b.append(a),t.append(b)}),o(a),c.DOMelement.css("top",i.offset().top-$(document).scrollTop()),c.DOMelement.css("left",-c.mouseOffsetX),$(window).mousemove(function(a){o(a),q(a)}),$(window).mouseup(p),$("*").css("user-select","none")}})},this.headerSticky=function(a){a.scroll(function(){var b=a.scrollTop(),c=a.offset()?0:h.offset().top,d=h.height()-i.height();b>c+d?i.css("transform","translate3d(0,"+d+"px,0)"):b>c?i.css("transform","translate3d(0,"+(b-c)+"px,0)"):i.css("transform","translate3d(0px)")}),a.scroll()},this.updateTable=function(){for(var a=0;a<b.length;a++)delete b[a];s(),k.setCellWidth(),h.trigger("colme:isReady")},this.refreshWidth=function(a){a.resizeAmount=0,a.resizeAcumulator=0;for(var b in a.children)this.refreshWidth(a.children[b]);a.parent&&(a.children.length&&a.DOMelement.width(a.getWidthResize(a.resizeAcumulator)),a.parent.resizeAcumulator+=a.getWidth())},f.addMarkup&&t(),s(),this.refreshWidth(k),f.resize&&this.resizable(),f.draggable){var u=$("#"+g.floater);0===u.length?(c.DOMelement=$("<div>",{id:g.floater}),c.DOMelement.append($("<div>",{"class":e.head.replace(".","")})),c.DOMelement.append($("<div>",{"class":e.body.replace(".","")})),c.DOMelement.css({position:"fixed"}),h.append(c.DOMelement)):c.DOMelement=u,this.draggable()}f.stickyH&&this.headerSticky(a.sticky),f.toggleC&&this.toggleable(),m(),h.trigger("colme:isReady")}var $;$.fn.colme=function(a){a.table=this;var b=new Colme(a);return{getLayout:b.getLayout,setLayout:b.setLayout}};